<template>
	<template if:true={loading}>
		<lightning-spinner alternative-text="Loading" size="large"></lightning-spinner>
	</template>
	<div class="" style="margin-bottom:16px;">
		<div class="">
			<div class="">
				<!-- <p class="slds-p-bottom_medium slds-p-horizontal_medium ">
                    <lightning-formatted-rich-text value={showDisclosure}></lightning-formatted-rich-text>
                </p> -->

				<!-- Displays status message when an assessment is saved/ submitted --START-->
				<template if:true={showToast}>
					<c-Show-Toast-Message message-from-component={totastmessage} is-show-modal={showToast}
						is-sucess={success} onclosetoast={closeToastHandler}></c-Show-Toast-Message>
				</template>
				<!-- Displays status message when an assessment is saved/ submitted --END-->

				<div class="rtmvpc-card slds-p-around_x-small">
					<!-- Displays button and picklist for navigations --START-->
					<div class="temp_flexbox_space-between">
						<div>
							<template lwc:if={showButtons.Section_Navigation.show}>
								<!-- <lightning-combobox name="Section Navigation" variant="label-hidden"
                                    value={showButtons.Section_Navigation.value}
                                    options={showButtons.Section_Navigation.options}
                                    onchange={section_navigationChangeHandler}>
                                </lightning-combobox> -->
							</template>
						</div>
						<div>
							<!-- <template lwc:if={showButtons.Summary}>
                                <lightning-button label="Summary" title="Summary" name="Summary" variant="brand"
                                    onclick={summaryClickHandler}>
                                </lightning-button>
                            </template> -->
						</div>
					</div>
					<!-- Displays button and picklist for navigations --END-->
					<div>
						<template if:true={showRefreshbutton}>
							<lightning-button variant="base" label="Refresh" title="Refresh" onclick={handleOnload}></lightning-button>
						</template>
					</div>
					<div
						style="position:absolute; display:inline-block; right:13px; margin-top:-47px; font-weight:bold;">
						<template if:true={isTemplate}>
							<a class="slds-button slds-button_reset slds-accordion__summary-action"
								title="Expand All / Collapse All" onclick={handleCollapseExpand}
								aria-controls="referenceId-21" aria-expanded="true">{buttonlabel}</a>
						</template>
					</div>


					<div>
						<template if:true={showFiles}>
							<lightning-layout multiple-rows="true">
								<template for:each={keyList} for:item="item" for:index="index">
									<lightning-layout-item size="4" key={item.key}>
										<table>
											<tr hidden>
												<td>
												</td>
												<td>
												</td>
											</tr>
											<tr>
												<td>
													<lightning-icon icon-name="doctype:flash" size="xx-small" onclick={handleDownload} title={item.url} alternative-text="File" class="slds-p-around_x-small">
													</lightning-icon>
												</td>
												<td align="left">
													{item.value}
												</td>
											</tr>
										</table>
									</lightning-layout-item>
								</template>
							</lightning-layout>
						</template>
					</div>
					
					<div>
						<ul class="slds-accordion">
							<li class="slds-accordion__list-item">
								<template if:false={isTemplate}>
									<template if:true={showDisclosure}>
										<section class={showAccordion}>
											<div class="slds-accordion__summary">
												<h2 class="slds-accordion__summary-heading">
													<button class="slds-button slds-button_reset slds-accordion__summary-action" onclick={handleAccordionSection} aria-controls="referenceId-21" aria-expanded="true">
                                            <span class="slds-accordion__summary-action-icon slds-button__icon slds-button__icon_left" aria-hidden="true">
                                                <lightning-icon icon-name="utility:chevrondown" size="x-small"></lightning-icon>
                                                </span>
                                                <span class="slds-accordion__summary-content" style="width:100%">
                                                    <div style="width:100%; display:flex; justify-content:space-between">
                                                        <div>Disclosure</div>
                                                    </div>
                                                </span>
                                            </button>
												</h2>
											</div>
											<div class="slds-accordion__content" id="referenceId-21">{showDisclosure}
											</div>
										</section>
									</template>
								</template>
								<!-- <template if:true={isTemplate}>
                                    <button class="slds-button slds-button_reset slds-accordion__summary-action" onclick={closeAccordionSection} aria-controls="referenceId-21" aria-expanded="true">{buttonlabel}</button>
                                    </br></br></br>
                                </template> -->
							</li>

							<template for:each={questionsAndAnswerss} for:item="questionaryEntry">
								<li class="slds-accordion__list-item" key={questionaryEntry.section}>
									<section data-accordian={questionaryEntry.sectionId} >

										<div class="slds-accordion__summary" >
											<h2 class="slds-accordion__summary-heading">
												<button  class="slds-button slds-button_reset slds-accordion__summary-action" data-id={questionaryEntry.sectionId} onclick={handleAccordionQuestion} aria-controls="referenceId-22" aria-expanded="true">
                                                    <span class="slds-accordion__summary-action-icon slds-button__icon slds-button__icon_left" aria-hidden="true">
                                                        <lightning-icon icon-name="utility:chevrondown" size="x-small"></lightning-icon>
                                                    </span>
                                                    <span class="slds-accordion__summary-content" style="width:100%">
                                                        <div style="width:100%; display:flex; justify-content:space-between">
                                                            <div>{questionaryEntry.section}</div>
                                                            <div class="slds-accordion__summary-contentrht">
                                                            <template if:false={isTemplate}>
                                                                <div class="slds-grid slds-wrap">
                                                                    <div class="slds-col slds-text-align_left cad-mw60" title="Responses">
                                                                        <lightning-icon icon-name="utility:number_input" alternative-text="Responses" size="x-small" title="Responses"></lightning-icon>
                                                                        &nbsp;<span>: {questionaryEntry.numberOfResponses}/{questionaryEntry.numberOfQuestions}</span>
                                                                    </div>
                                                                    <div class="slds-col slds-text-align_left cad-mw65" title="% Completed">
                                                                        <lightning-icon icon-name="utility:success" alternative-text="% Completed" size="x-small" title="% Completed"></lightning-icon>
                                                                        &nbsp;<span>: {questionaryEntry.responsesPercentage}%</span>
                                                                    </div>
                                                                    <div class="slds-col cib-flag slds-text-align_left cad-mw50" title="Additional Requests">
                                                                        <lightning-icon icon-name="utility:priority" alternative-text="Additional Requests" size="x-small" title="Additional Requests"></lightning-icon>
                                                                        &nbsp;<span>: {questionaryEntry.displayFlag}</span>
                                                                    </div>
                                                                </div>
                                                            </template>
                                                            <template if:true={isTemplate}>
                                                            <template if:true={isAccountAssessment}>
                                                                <div class="slds-grid slds-wrap">
                                                                    <div class="slds-col slds-text-align_left cad-mw60" title="Responses">
                                                                        <lightning-icon icon-name="utility:number_input" alternative-text="Responses" size="x-small" title="Responses"></lightning-icon>
                                                                        &nbsp;<span>: {questionaryEntry.numberOfResponses}/{questionaryEntry.numberOfQuestions}</span>
                                                                    </div>
                                                                    <div class="slds-col slds-text-align_left cad-mw65" title="% Completed">
                                                                        <lightning-icon icon-name="utility:success" alternative-text="% Completed" size="x-small" title="% Completed"></lightning-icon>
                                                                        &nbsp;<span>: {questionaryEntry.responsesPercentage}%</span>
                                                                    </div>
                                                                    <div class="slds-col cib-flag slds-text-align_left cad-mw50" title="Additional Requests">
                                                                        <lightning-icon icon-name="utility:priority" alternative-text="Additional Requests" size="x-small" title="Additional Requests"></lightning-icon>
                                                                        &nbsp;<span>: {questionaryEntry.displayFlag}</span>
                                                                    </div>
                                                                </div></template>
                                                            </template>
                                                            </div>
                                                        </div>
                                                    </span>
                                                </button>
											</h2>
										</div>
										<div class="slds-accordion__content">
											<c-rtmvpc-render-question-template responses={questionaryEntry.questions}
												issupplier={isSupplier} sectionid={questionaryEntry.sectionId}
												assessmentid={assessment} onvaluechange={onResponseChange}
												onfileupload={handleFileUpload} onselectchange={handlechatHistory}
												ondeleteattachment={handledeletefile} 
												onselectquestion={selectquestionHandler} recid={recordId}
												onflagchange={handleFlagResponseMethod} uploading-file={uploadingFile}
												onactionchange={handleActionResponse} onrejectchange={handleReject}
												timeline={timeline} is-preview-component={isPreviewComponent}>
											</c-rtmvpc-render-question-template>
										</div>

									</section>
								</li>
							</template>

						</ul>
					</div>

					<!-- <template if:true={isSubmitted}>
                        <div class="slds-p-around_medium slds-p-left_none slds-p-right_none"
                            style="display:flex; justify-content: space-between; align-items:center">
                        </div>
                    </template> -->
					<!-- <div class="slds-border_top slds-m-top_small"></div> -->

					<!-- Displays Save, Save & Submit buttons if the Assessment is not Submitted --START-->
					<!-- <template lwc:if={showButtons.Save_Submit}>
                        <br>
                        <lightning-button variant="Brand" label="Save & Submit" title="Save Response"
                            onclick={handleSubmit} flexibility="auto" class="slds-float--right slds-button_neutral">
                        </lightning-button>
                        &nbsp;&nbsp;
                        <lightning-button variant="Brand" label="Save" title="Save Response" onclick={handleSave}
                            flexibility="auto" class="slds-float--right" style="margin-right: 5px;"></lightning-button>
                        &nbsp;&nbsp;</br>
                    </template> -->
					<!-- Displays Save, Save & Submit buttons if the Assessment is not Submitted --END-->
				</div>
			</div>
			<!-- <template if:true={showspinner}>
				<div class="exampleHolder">
					<lightning-spinner alternative-text="Loading" size="large"></lightning-spinner>
				</div>
			</template> -->
			<!-- Footer --START-->
			<!-- <div class="slds-p-horizontal_large slds-p-top_small">
                <span>SUBMITTED BY: &nbsp;&nbsp;<b>{supplierAssessmentName}</b></span><br/>
                <span>SUBMITTED DATE: &nbsp;&nbsp;<b>{supplierAssCreatedDate}</b>
                </span>
            </div> -->
			<!-- Footer --END-->
		</div>
	</div>
	 <template if:false={isTemplate}>
		<div class="slds-p-horizontal_medium slds-p-vertical_x-small slds-border-top"
			style="position:absolute; width:100%; height:40px; bottom:0px; text-align:right; background:#e8eaed; border-top:1px solid #c9c9c9;">
			<!-- Displays Save, Save & Submit buttons if the Assessment is not Submitted --START-->
			<template lwc:if={showButtons.Save_Submit}>
				<lightning-button variant="Brand" label="Save & Submit" title="Save Response" onclick={handleSubmit}
					flexibility="auto" class="slds-float--right slds-button_neutral">
				</lightning-button>
				&nbsp;&nbsp;
				<lightning-button variant="Brand" label="Save" title="Save Response" onclick={handleSave}
					flexibility="auto" class="slds-float--right" style="margin-right:5px;"></lightning-button>
				&nbsp;&nbsp;
			</template>

			<!-- Displays Save, Save & Submit buttons if the Assessment is not Submitted --END-->
		</div>
		 <template if:true={isSupplierModalPopup}>
        <!-- Modal/Popup Box LWC starts here -->
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <!-- Modal/Popup Box LWC header here -->
                <!-- <header class="slds-modal__header"> -->
                    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeModal}>
                        <lightning-icon icon-name="utility:close"
                            alternative-text="close"
                            variant="inverse"
                            size="small" ></lightning-icon>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                    <!-- <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Modal/PopUp Box header LWC</h2> -->
                <!-- </header> -->
                <!-- Modal/Popup Box LWC body starts here -->
                <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                    <p><b>Do you want to Submit the review?
                    </b></p>
                </div>
                <!-- Modal/Popup Box LWC footer starts here -->
                <footer class="slds-modal__footer">
                    <button class="slds-button slds-button_neutral" onclick={closeModal} title="No">No</button>
                    <button class="slds-button slds-button_brand" onclick={submitAssessment} title="Yes">Yes</button>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
	</template>
	<template if:true={isTemplate}>
		
		<template if:true={showcustomerbuttons}>
			<template if:true={showInReview}>
				<div class="slds-p-horizontal_medium slds-p-top_xx-small slds-border-top"
			style="position:absolute; width:100%; height:40px; bottom:0px; text-align:right; background:#e8eaed; border-top:1px solid #c9c9c9;">
				<lightning-button variant="Brand" label="Start Review" title="Save Response" onclick={handleStartReview}
					flexibility="auto" class="slds-float--right slds-button_neutral">
				</lightning-button>
				</div>
			</template>
			<template if:true={showSaveAndSubmit}>
				<div class="slds-p-horizontal_medium slds-p-top_xx-small slds-border-top"
			style="position:absolute; width:100%; height:40px; bottom:0px; text-align:right; background:#e8eaed; border-top:1px solid #c9c9c9;">
			   <lightning-button-group>
				<lightning-button variant="Brand" label="Save" title="Save Response"
					onclick={handleSaveCustomer} flexibility="auto" class=" slds-m-around_xxx-small">
				</lightning-button>
				<lightning-button variant="Brand" label="Submit & Follow-Up" title="Save Response" disabled={showFollowButton}
					onclick={handleSubmitCustomer} flexibility="auto" class="slds-m-around_xxx-small">
				</lightning-button>
				<lightning-button variant="Brand" label="Submit & Close Review" title="Save Response"
					onclick={handleSubmitReviewCustomer} flexibility="auto" class="slds-m-around_xxx-small">
				</lightning-button>
				 </lightning-button-group>
				</div>
				<!-- &nbsp;&nbsp;
                <lightning-button variant="Brand" label="Save" title="Save Response" onclick={handleSaveCustomer}
                    flexibility="auto" class="slds-float--right" style="margin-right:5px;"></lightning-button>
                &nbsp;&nbsp; -->
					 <template if:true={isCustomerModalPopup}>
        <!-- Modal/Popup Box LWC starts here -->
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <!-- Modal/Popup Box LWC header here -->
                <!-- <header class="slds-modal__header"> -->
                    <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={ccloseModal}>
                        <lightning-icon icon-name="utility:close"
                            alternative-text="close"
                            variant="inverse"
                            size="small" ></lightning-icon>
                        <span class="slds-assistive-text">Close</span>
                    </button>
                    <!-- <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Modal/PopUp Box header LWC</h2> -->
                <!-- </header> -->
                <!-- Modal/Popup Box LWC body starts here -->
                <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-2">
                    <p><b>Do you want to Submit the review?
                    </b></p>
                </div>
                <!-- Modal/Popup Box LWC footer starts here -->
                <footer class="slds-modal__footer">
                    <button class="slds-button slds-button_neutral" onclick={ccloseModal} title="No">No</button>
                    <!-- <button class="slds-button slds-button_brand" onclick={submitAssessment} title="Yes">Yes</button> -->
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
			

			</template>
			
		</template>
		
		
	</template>
	
</template>