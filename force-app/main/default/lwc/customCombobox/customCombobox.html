<template>
	<div class="slds-form-element">
		<template lwc:if={show.label}>
			<label class="slds-form-element__label">{label}</label>
		</template>
		<div class="slds-form-element__control">
			<div class="slds-combobox_container">
				<div data-id="renderComboboxOptions"
					class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click">
					<div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_left-right">
						<template lwc:if={allowSearch}>
							<template lwc:if={selectedOption}>
								<template lwc:if={selectedOption.icon}>
									<span class="slds-icon_container slds-combobox__input-entity-icon">
                                        <lightning-icon icon-name={selectedOption.icon} size="x-small"></lightning-icon>
                                    </span>
								</template>
								<template lwc:else>
									<span class="slds-icon_container slds-input__icon slds-input__icon_left">
                                        <lightning-icon icon-name="utility:search" size="x-small"></lightning-icon>
                                    </span>
								</template>
							</template>
							<template lwc:else>
								<span class="slds-icon_container slds-input__icon slds-input__icon_left">
                                    <lightning-icon icon-name="utility:search" size="x-small"></lightning-icon>
                                </span>
							</template>
							<input value={searchText} class="slds-input slds-combobox__input" role="combobox" placeholder={placeholder} onclick={showOptionsHandler} onblur={hideOptionsHandler} onkeyup={searchOptionsHandler} onkeydown={searchOptionsHandler} onchange={searchOptionsHandler}/>
							<template lwc:if={searchText}>
								<button class="slds-button slds-button_icon slds-input__icon slds-input__icon_right" title="Remove selected option">
                                    <lightning-button-icon icon-name="utility:close" size="x-small" onclick={clearSearchHandler}>
								</lightning-button-icon>
                                </button>
							</template>
						</template>
						<template lwc:else>
							<span class="slds-icon_container slds-icon-utility-down slds-input__icon slds-input__icon_right">
                                <lightning-icon icon-name="utility:down" size="x-small"></lightning-icon>
                            </span>
						</template>
					</div>
					<template lwc:if={show.options}>
						<div class="slds-dropdown slds-dropdown_length-with-icon-7 slds-dropdown_fluid" role="listbox"
							tabindex="0" aria-busy="false">
							<ul class="slds-listbox slds-listbox_vertical" role="presentation">
								<template for:each={optionsData} for:item="option">
									<li key={option.value} role="presentation" class="slds-listbox__item"
										data-optionvalue={option.value} data-optionlabel={option.label}
										data-optionicon={option.icon} onclick={optionClickHandler}>
										<div id={option.value}
											class="slds-media slds-listbox__option slds-listbox__option_entity slds-listbox__option_has-meta"
											role="option">
											<template lwc:if={option.icon}>
												<span class="slds-media__figure slds-listbox__option-icon">
                                                    <lightning-icon icon-name={option.icon} size="small"></lightning-icon>
                                                </span>
											</template>
											<template lwc:if={option.label}>
												<span class="slds-media__body">
                                                    <span class="slds-listbox__option-text slds-listbox__option-text_entity">{option.label}</span>
												</span>
											</template>
										</div>
									</li>
								</template>
							</ul>
						</div>
					</template>
				</div>
			</div>
		</div>
	</div>
</template>